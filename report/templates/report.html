{% extends 'base.html' %}
{% load static %}

{% block headone %}
<title>Report</title>
<link rel="stylesheet" type="text/css" href="{% static '/css/report.css' %}">
<!-- <script src="https://code.jquery.com/jquery-3.4.1.slim.min.js" integrity="sha384-J6qa4849blE2+poT4WnyKhv5vZF5SrPo0iEjwBvKU7imGFAV0wwj1yYfoRSJoZ+n" crossorigin="anonymous"></script>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script> -->
{% endblock %}


{% block content %}

<!-- <header class="fixed-top">
  <a href="{% url 'nobokek:show_nobokek' %}" class="logo">NoBokek App</a>
  <div class="group">
    
    <ul class="navigation">
      <li><a href="{% url 'add:show_add' %}">Add</a></li>
      <li><a href="#">Statistic</a></li>
      <li><a href="{% url 'report:show_report' %}">Report User Info</a></li>
      <li><a href="#">Forum</a></li>
      <li><a href="{% url 'nobokek:contact' %}" class="contact-us">Contact Us</a></li>      
      <li><a href="{% url 'nobokek:logout' %}" class="logout">Logout</a></li>
    </ul>
    <div class="search">
      <span class="icon">
        <ion-icon name="search-outline" class="searchBtn"></ion-icon>
        <ion-icon name="close-outline" class="closeBtn"></ion-icon>
      </span>
    </div>
    <ion-icon name="menu-outline" class="menuToggle"></ion-icon>
  </div>
  <div class="searchBox">
    <input type="text" placeholder="Search here...">
  </div>
  
</header> -->
  <body>
    <main>
      <div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom">
        <h1 class="h1">Dashboard</h1>
      </div>

      <div class="row">
        <div class="col d-flex justify-content-center mt-5">
          <div class="card border border-dark" style="width: 30rem;">
            <h1 class="judulDanaTerkumpul center">Total Income</h1>
            <div class="container" id="totalIncome">
                
            </div>  
          </div>
        </div>
        <div class="col d-flex justify-content-center mt-5">
          <div class="card border border-dark" style="width: 30rem;">
            <h1 class="judulDanaTerkumpul center">Total Outcome</h1>
            <div class="container" id="totalOutcome">
    
            </div>  
          </div>
        </div>
      </div>
      <h2 class="mt-5">Recent Transaction</h2>
      <div class="table-responsive">
        <table class="table table-striped table-sm">
          <thead>
            <tr>
              <th scope="col">Date</th>
              <th scope="col">Transaction</th>
              <th scope="col">Detail Transaction</th>
            </tr>
          </thead>
          <tbody id="detailTransaction">

          </tbody>
        </table>
      </div>
    </main>
  </body>
    

      

<!-- Bagian Pesan -->
<script>

  $(document).ready(function(){
      show_report();
      show_detail();
  });

  function show_report(){
    let report = "";
    let report1 ="";
    $.ajax({
      url: "{% url 'add:show_json' %}",
      type: 'GET',
      dataType:"json",
      success: function(data){

        let incomeUser = 0;
        let outcomeUser = 0;
        for(i of data){
          incomeUser += i.fields.income
          outcomeUser += i.fields.outcome
          
        }
        report += `<h3 class="danaTerkumpul center mb-5">Rp${incomeUser}</h3>`
        $('#totalIncome').html(report)
        
        report1 += `<h3 class="danaTerkumpul center mb-5">Rp${outcomeUser}</h3>`
        $('#totalOutcome').html(report1)
      },
      error: function(data){
        console.log("Error")
      }
    })
  }

  function show_detail(){
    let show_transaksi = "";
    $.ajax({
      url: "{% url 'add:show_json' %}",
      type: 'GET',
      dataType:"json",
      success: function(data){
        for (i of data){
          if(i.fields.income == null){
            console.log(i);
            show_transaksi += `
            <tr>
              <td>${i.fields.date}</td>
              <td>(-)${i.fields.outcome}</td>
              <td>${i.fields.desc_out}</td>
            </tr>`
            $('#detailTransaction').html(show_transaksi)
          }else{
            console.log(i);
            show_transaksi += `
            <tr>
              <td>${i.fields.date}</td>
              <td>(+)${i.fields.income}</td>
              <td>${i.fields.desc_in}</td>
            </tr>`
            $('#detailTransaction').html(show_transaksi)
          }
        }
      }
    })
  }

</script>
{% endblock %}