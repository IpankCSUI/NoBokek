{% extends 'base.html' %}
{% load static %}

{% block headone %}

<title>Report</title>
<link rel="stylesheet" type="text/css" href="{% static '/css/report.css' %}">
{% endblock %}


{% block content %}

<!-- Navbar -->


<!-- Bagian Riwayat -->
<div class="container">
  <div class="row">
    <div class="col d-flex justify-content-center mt-5">
      <div class="card border border-dark" style="width: 30rem;">
        <h1 class="judulDanaTerkumpul center">Total Income</h1>
              <br>
                  <div class="container">
                      {% if donasi_terkumpul.donatur.all.count == 0 %}
                      <h3 class="belum-ada center">Belum ada donasi terkumpul</h3>
                      {% else %}
                      <h3 class="danaTerkumpul center">Rp.100000{{ donasi_terkumpul }}</h3>
                      {% endif %}
                  </div>
              <br>
            </div>
    </div>
    <div class="col d-flex justify-content-center mt-5">
      <div class="card border border-dark" style="width: 30rem;">
        <h1 class="judulDanaTerkumpul center">Total Outcome</h1>
              <br>
                  <div class="container">
                      {% if donasi_terkumpul.donatur.all.count == 0 %}
                      <h3 class="belum-ada center">Belum ada donasi terkumpul</h3>
                      {% else %}
                      <h3 class="danaTerkumpul center">Rp.10000 {{ donasi_terkumpul }}</h3>
                      {% endif %}
                  </div>
              <br>
            </div>
    </div>
  </div>
</div>

<div style="height: 50px;"></div>


<!-- Bagian Pesan -->
<script>
    $(document).ready(function(){
        
    
        $("#id_isi").keyup(function(){
            //character count isi txt area pesan
    
            var txtlength = $("#id_isi").val().length;
            $("#lettercount").empty();
    
            if (txtlength > 0) {
                $("#lettercount").append(txtlength+"/100");
            } 
            
            if (txtlength > 85) {
                $("#lettercount").empty();
                $("#lettercount").append('<span style="color:red;">' + txtlength + '/100</span>');
            }
            
        });
    
    
        $("#tombol-kirim").click(function(){
            //ajax untuk simpan pesan dan nampilin pesan yg baru dimasukkin tsb.
    
            var isi = $("#id_isi").val();
            // alert(isi);
            if (isi.length > 0 && isi != "") {
                $.ajax({url: "pesanajax?q=" + isi, success: function(result){
                    console.log(result);
        
                    $("#divpesan").empty();
                    $("#id_isi").val("");
                    $("#lettercount").empty();
        
                    $("#divpesan").append("<p class=\"judul-pesan\">Target Kamu</p>")
                    $("#divpesan").append('<div class="row" id="kumpulan-pesan"></div>')
                    var i;
                    for (i=0; i<result.length; i++){
                        var isiPesan = result[i].fields.isi;
                        var nama = result[i].fields.nama;
                        // alert(isiPesan + nama);
                        $("#kumpulan-pesan").append('<div class="col-md-4 mb-4"> <div class="card" style="height: 200px;"><div class="card-body"><div class="pesan-textfield"><p style="padding-top: 10px;">' +isiPesan+ '</p></div><div class="pesan-nama"><p style="right: 0; position: absolute;">-' +nama+ '</p></div></div></div></div>')
                    }
                }});
            } else {
                alert("Anda belum mengisi pesan!");
            }
            
        });
    });
    </script>

<div class="container-tulisan">
    <div class="bagian-text" id="divpesan">
        <p class="judul-pesan">Target Kamu</p>
        <div class="row" id="kumpulan-pesan">
            {% for pesan in pesans %}
              <div class="col-md-4 mb-4">
                  <div class="card" style="height: 300px; margin-top: 20px; margin-left: 35px;">
                      <div class="card-body">
                          <div class="pesan-textfield">
                              <p style="padding-top: 30px;">{{ pesan.isi }}</p>
                          </div>
                          <div class="pesan-nama">
                              <p style="right: 100px; position: absolute;">- {{ pesan.nama }}</p>
                          </div>
                      </div>
                  </div>
              </div>
            {% endfor %}
        </div>
    </div>
    <div class="bagian-text">
        {%if user.is_authenticated%}
        <p class="judul-pesan">Berikan Target</p>
        <!-- <form action="/riwayat/" method="POST"> -->
        
            {% csrf_token %}
            <p>
                <textarea name="isi" cols="40" rows="10" class="form-control" maxlength="100"
                    placeholder="Masukkan pesan anda" required="" id="id_isi"></textarea>
            </p>
            <p id="lettercount"></p>
            <div class="kananin">
                <button class="btn btn-primary rounded-pill btn-donasi" id="tombol-kirim">Kirim</button>
            </div>

        <!-- </form> -->
        {% else %}
        <p class="judul-pesan" style="font-size: 30px; color: black;"><a href="/login/">login</a> untuk memberikan
            pesan</p>
        {% endif %}
    </div>
</div>


<!-- uwu -->
{% endblock %}